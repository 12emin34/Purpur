From 28a031dde622114b5b89e25f0cad11416b91ef7b Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Sat, 4 Apr 2020 03:07:59 -0500
Subject: [PATCH] Skip events if there's no listeners

---
 src/main/java/net/minecraft/server/CommandDispatcher.java | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/main/java/net/minecraft/server/CommandDispatcher.java b/src/main/java/net/minecraft/server/CommandDispatcher.java
index 3b15f953bc..1a2213873a 100644
--- a/src/main/java/net/minecraft/server/CommandDispatcher.java
+++ b/src/main/java/net/minecraft/server/CommandDispatcher.java
@@ -256,6 +256,7 @@ public class CommandDispatcher {
         map.put(this.b.getRoot(), rootcommandnode);
         this.a(this.b.getRoot(), rootcommandnode, entityplayer.getCommandListener(), (Map) map);
 
+        if (PlayerCommandSendEvent.getHandlerList().getRegisteredListeners().length > 0) { // Purpur - skip all this crap if there's nothing listening
         Collection<String> bukkit = new LinkedHashSet<>();
         for (CommandNode node : rootcommandnode.getChildren()) {
             bukkit.add(node.getName());
@@ -271,6 +272,7 @@ public class CommandDispatcher {
             }
         }
         // CraftBukkit end
+        } // Purpur - skip event
         entityplayer.playerConnection.sendPacket(new PacketPlayOutCommands(rootcommandnode));
     }
 
-- 
2.24.0

