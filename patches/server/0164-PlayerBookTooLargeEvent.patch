From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: BillyGalbreath <blake.galbreath@gmail.com>
Date: Wed, 23 Dec 2020 00:43:59 -0600
Subject: [PATCH] PlayerBookTooLargeEvent


diff --git a/src/main/java/net/minecraft/server/PlayerConnection.java b/src/main/java/net/minecraft/server/PlayerConnection.java
index f16109a08804e0942f2f41d9637bd9b88c1c8893..33327da588fec7c7458081d62ec6680d178c7dec 100644
--- a/src/main/java/net/minecraft/server/PlayerConnection.java
+++ b/src/main/java/net/minecraft/server/PlayerConnection.java
@@ -928,8 +928,9 @@ public class PlayerConnection implements PacketListenerPlayIn {
         ItemStack testStack = packetplayinbedit.getBook();
         if (!server.isPrimaryThread() && !testStack.isEmpty() && testStack.getTag() != null) {
             NBTTagList pageList = testStack.getTag().getList("pages", 8);
-            if (pageList.size() > 50) {
+            if (pageList.size() > 100) { // Purpur - java edition has 100 pages
                 PlayerConnection.LOGGER.warn(this.player.getName() + " tried to send a book with too many pages");
+                net.pl3x.purpur.event.player.PlayerBookTooLargeEvent event = new net.pl3x.purpur.event.player.PlayerBookTooLargeEvent(player.getBukkitEntity(), testStack.asBukkitCopy()); if (event.shouldKickPlayer()) // Purpur
                 minecraftServer.scheduleOnMain(() -> this.disconnect("Book too large!"));
                 return;
             }
@@ -942,6 +943,7 @@ public class PlayerConnection implements PacketListenerPlayIn {
                 int byteLength = testString.getBytes(java.nio.charset.StandardCharsets.UTF_8).length;
                 if (byteLength > 256 * 4) {
                     PlayerConnection.LOGGER.warn(this.player.getName() + " tried to send a book with with a page too large!");
+                    net.pl3x.purpur.event.player.PlayerBookTooLargeEvent event = new net.pl3x.purpur.event.player.PlayerBookTooLargeEvent(player.getBukkitEntity(), testStack.asBukkitCopy()); if (event.shouldKickPlayer()) // Purpur
                     minecraftServer.scheduleOnMain(() -> this.disconnect("Book too large!"));
                     return;
                 }
@@ -965,6 +967,7 @@ public class PlayerConnection implements PacketListenerPlayIn {
 
             if (byteTotal > byteAllowed) {
                 PlayerConnection.LOGGER.warn(this.player.getName() + " tried to send too large of a book. Book Size: " + byteTotal + " - Allowed:  "+ byteAllowed + " - Pages: " + pageList.size());
+                net.pl3x.purpur.event.player.PlayerBookTooLargeEvent event = new net.pl3x.purpur.event.player.PlayerBookTooLargeEvent(player.getBukkitEntity(), testStack.asBukkitCopy()); if (event.shouldKickPlayer()) // Purpur
                 minecraftServer.scheduleOnMain(() -> this.disconnect("Book too large!"));
                 return;
             }
