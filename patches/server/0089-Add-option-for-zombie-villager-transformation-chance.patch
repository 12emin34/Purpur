From 68a4b563397296fe762231c5cd9733b69fa83a0d Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Thu, 19 Dec 2019 16:59:46 -0600
Subject: [PATCH] Add option for zombie villager transformation chance

---
 .../java/net/minecraft/server/EntityZombie.java   | 15 +++++++++++++--
 .../java/net/pl3x/purpur/PurpurWorldConfig.java   |  9 +++++++++
 2 files changed, 22 insertions(+), 2 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityZombie.java b/src/main/java/net/minecraft/server/EntityZombie.java
index e9da244d98..0f0df08fff 100644
--- a/src/main/java/net/minecraft/server/EntityZombie.java
+++ b/src/main/java/net/minecraft/server/EntityZombie.java
@@ -457,8 +457,19 @@ public class EntityZombie extends EntityMonster {
     @Override
     public void b(EntityLiving entityliving) {
         super.b(entityliving);
-        if ((this.world.getDifficulty() == EnumDifficulty.NORMAL || this.world.getDifficulty() == EnumDifficulty.HARD) && entityliving instanceof EntityVillager) {
-            if (this.world.getDifficulty() != EnumDifficulty.HARD && this.random.nextBoolean()) {
+        // Purpur start
+        if (entityliving instanceof EntityVillager) {
+            double chance = 0.0D;
+            switch (world.getDifficulty()) {
+                case EASY:
+                    chance = world.purpurConfig.zombieVillagerTransformationChanceEasy;
+                case NORMAL:
+                    chance = world.purpurConfig.zombieVillagerTransformationChanceNormal;
+                case HARD:
+                    chance = world.purpurConfig.zombieVillagerTransformationChanceHard;
+            }
+            if (chance == 0.0D || random.nextDouble() > chance) {
+                // Purpur end
                 return;
             }
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index f81c0cde39..69b3bef766 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -230,4 +230,13 @@ public class PurpurWorldConfig {
     private void zombieHorseSettings() {
         zombieHorseSpawnChance = (float) getDouble("mobs.zombie_horse.spawn-chance", zombieHorseSpawnChance);
     }
+
+    public double zombieVillagerTransformationChanceEasy = 0.0D;
+    public double zombieVillagerTransformationChanceNormal = 0.5D;
+    public double zombieVillagerTransformationChanceHard = 1.0D;
+    private void zombieVillagerSettings() {
+        zombieVillagerTransformationChanceEasy = getDouble("mobs.zombie-villager.transformation-chance.easy", zombieVillagerTransformationChanceEasy);
+        zombieVillagerTransformationChanceNormal = getDouble("mobs.zombie-villager.transformation-chance.normal", zombieVillagerTransformationChanceNormal);
+        zombieVillagerTransformationChanceHard = getDouble("mobs.zombie-villager.transformation-chance.hard", zombieVillagerTransformationChanceHard);
+    }
 }
-- 
2.24.0

