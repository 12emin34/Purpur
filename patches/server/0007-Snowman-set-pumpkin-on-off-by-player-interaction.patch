From fa488761323e77e154ec12c60fe99e2e6a98ff0e Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Fri, 3 May 2019 23:58:44 -0500
Subject: [PATCH] Snowman set pumpkin on/off by player interaction

---
 .../java/net/minecraft/server/EntitySnowman.java | 16 ++++++++++++++++
 src/main/java/net/pl3x/purpur/PurpurConfig.java  |  7 +++++++
 2 files changed, 23 insertions(+)

diff --git a/src/main/java/net/minecraft/server/EntitySnowman.java b/src/main/java/net/minecraft/server/EntitySnowman.java
index fe1381cc17..42d0c0017d 100644
--- a/src/main/java/net/minecraft/server/EntitySnowman.java
+++ b/src/main/java/net/minecraft/server/EntitySnowman.java
@@ -8,6 +8,7 @@ import org.bukkit.event.player.PlayerShearEntityEvent;
 
 public class EntitySnowman extends EntityGolem implements IRangedEntity {
 
+    private static final RecipeItemStack PUMPKIN = RecipeItemStack.a(Blocks.PUMPKIN.getItem(), Blocks.CARVED_PUMPKIN.getItem(), Blocks.JACK_O_LANTERN.getItem()); // Purpur
     private static final DataWatcherObject<Byte> b = DataWatcher.a(EntitySnowman.class, DataWatcherRegistry.a);
 
     public EntitySnowman(EntityTypes<? extends EntitySnowman> entitytypes, World world) {
@@ -126,6 +127,21 @@ public class EntitySnowman extends EntityGolem implements IRangedEntity {
             itemstack.damage(1, entityhuman, (entityhuman1) -> {
                 entityhuman1.d(enumhand);
             });
+
+            // Purpur start
+            if (net.pl3x.purpur.PurpurConfig.snowmanDropsPumpkin) {
+                EntityItem pumpkin = new EntityItem(world, locX, locY, locZ, new ItemStack(Blocks.PUMPKIN.getItem()));
+                pumpkin.pickupDelay = 10;
+                world.addEntity(pumpkin);
+            }
+            return true;
+        } else if (net.pl3x.purpur.PurpurConfig.snowmanPumpkinPutBack && !hasPumpkin() && PUMPKIN.test(itemstack)) {
+            setHasPumpkin(true);
+            if (!entityhuman.abilities.canInstantlyBuild) {
+                itemstack.subtract(1);
+            }
+            return true;
+            // Purpur end
         }
 
         return super.a(entityhuman, enumhand);
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index d013f84076..37bab6180c 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -135,4 +135,11 @@ public class PurpurConfig {
     private static void cowsSettings() {
         feedMushroomsToCows = getInt("settings.mobs.cow.feed-mushrooms-for-mooshroom", feedMushroomsToCows);
     }
+
+    public static boolean snowmanDropsPumpkin = false;
+    public static boolean snowmanPumpkinPutBack = false;
+    private static void snowmansSettings() {
+        snowmanDropsPumpkin = getBoolean("settings.mobs.snow_golem.drops-pumpkin-when-sheared", snowmanDropsPumpkin);
+        snowmanPumpkinPutBack = getBoolean("settings.mobs.snow_golem.pumpkin-can-be-added-back", snowmanPumpkinPutBack);
+    }
 }
-- 
2.20.1

