From 6cb81e2b5db9fdc1f29f2a71d4ad27ed2b268657 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Sat, 1 Jun 2019 01:16:35 -0500
Subject: [PATCH] Always place dragon egg when dragon is killed

---
 src/main/java/net/minecraft/server/EnderDragonBattle.java | 4 +++-
 src/main/java/net/pl3x/purpur/PurpurConfig.java           | 5 +++++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EnderDragonBattle.java b/src/main/java/net/minecraft/server/EnderDragonBattle.java
index 6700c8c65..f0c77eb6c 100644
--- a/src/main/java/net/minecraft/server/EnderDragonBattle.java
+++ b/src/main/java/net/minecraft/server/EnderDragonBattle.java
@@ -13,6 +13,8 @@ import java.util.Set;
 import java.util.UUID;
 import java.util.function.Predicate;
 import javax.annotation.Nullable;
+
+import net.pl3x.purpur.PurpurConfig;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -356,7 +358,7 @@ public class EnderDragonBattle {
             this.bossBattle.setVisible(false);
             this.a(true);
             this.n();
-            if (!this.l) {
+            if (PurpurConfig.enderDragonDeathAlwaysPlacesEggBlock || !this.l) { // Purpur - always place dragon egg
                 this.d.setTypeUpdate(this.d.getHighestBlockYAt(HeightMap.Type.MOTION_BLOCKING, WorldGenEndTrophy.a), Blocks.DRAGON_EGG.getBlockData());
             }
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index abc43c4e3..4fbf12b9f 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -177,6 +177,11 @@ public class PurpurConfig {
         InventoryType.BARREL.setDefaultSize(packedBarrels ? 54 : 27);
     }
 
+    public static boolean enderDragonDeathAlwaysPlacesEggBlock = true;
+    private static void enderDragonDeathAlwaysPlacesEggBlock() {
+        enderDragonDeathAlwaysPlacesEggBlock = getBoolean("settings.ender-dragon-death-always-places-egg-block", enderDragonDeathAlwaysPlacesEggBlock);
+    }
+
     public static boolean ridableBat = true;
     public static boolean ridableBlaze = true;
     public static boolean ridableCat = true;
-- 
2.23.0.rc1

