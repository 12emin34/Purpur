From 07bc84f06dc6888d04e34e3de8f4da1d250948f6 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Sun, 7 Jul 2019 19:52:16 -0500
Subject: [PATCH] Add chance for zombie horse natural spawns

---
 .../java/net/minecraft/server/WorldServer.java | 18 ++++++++++++------
 .../java/net/pl3x/purpur/PurpurConfig.java     |  5 +++++
 2 files changed, 17 insertions(+), 6 deletions(-)

diff --git a/src/main/java/net/minecraft/server/WorldServer.java b/src/main/java/net/minecraft/server/WorldServer.java
index a9765cc9b0..e160b0aa59 100644
--- a/src/main/java/net/minecraft/server/WorldServer.java
+++ b/src/main/java/net/minecraft/server/WorldServer.java
@@ -402,12 +402,18 @@ public class WorldServer extends World {
                 boolean flag1 = this.getGameRules().getBoolean(GameRules.DO_MOB_SPAWNING) && this.random.nextDouble() < (double) difficultydamagescaler.b() * paperConfig.skeleHorseSpawnChance; // Paper
 
                 if (flag1) {
-                    EntityHorseSkeleton entityhorseskeleton = (EntityHorseSkeleton) EntityTypes.SKELETON_HORSE.a((World) this);
-
-                    entityhorseskeleton.r(true);
-                    entityhorseskeleton.setAgeRaw(0);
-                    entityhorseskeleton.setPosition((double) blockposition.getX(), (double) blockposition.getY(), (double) blockposition.getZ());
-                    this.addEntity(entityhorseskeleton, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING); // CraftBukkit
+                    // Purpur start
+                    EntityHorseAbstract horse;
+                    if (net.pl3x.purpur.PurpurConfig.zombieHorseSpawnChance > 0F && random.nextFloat() <= net.pl3x.purpur.PurpurConfig.zombieHorseSpawnChance) {
+                        horse = EntityTypes.ZOMBIE_HORSE.a(this);
+                    } else {
+                        horse = EntityTypes.SKELETON_HORSE.a(this);
+                        ((EntityHorseSkeleton) horse).r(true);
+                    }
+                    horse.setAgeRaw(0);
+                    horse.setPosition((double) blockposition.getX(), (double) blockposition.getY(), (double) blockposition.getZ());
+                    this.addEntity(horse, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING); // CraftBukkit
+                    // Purpur end
                 }
 
                 this.strikeLightning(new EntityLightning(this, (double) blockposition.getX() + 0.5D, (double) blockposition.getY(), (double) blockposition.getZ() + 0.5D, flag1), org.bukkit.event.weather.LightningStrikeEvent.Cause.WEATHER); // CraftBukkit
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index 5001fedb8f..9f3b383698 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -196,6 +196,11 @@ public class PurpurConfig {
         snowmanPumpkinPutBack = getBoolean("settings.mobs.snow_golem.pumpkin-can-be-added-back", snowmanPumpkinPutBack);
     }
 
+    public static float zombieHorseSpawnChance = 0F;
+    private static void zombieHorseSettings() {
+        zombieHorseSpawnChance = (float) getDouble("settings.mobs.zombie_horse.spawn-chance", zombieHorseSpawnChance);
+    }
+
     public static boolean largeEnderChests = true;
     private static void largeEnderChests() {
         largeEnderChests = getBoolean("settings.large-ender-chests", largeEnderChests);
-- 
2.20.1

