From 7f41b1ff626fe428ddef47f024791aa18cef65dd Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Wed, 10 Jul 2019 20:43:05 -0500
Subject: [PATCH] Option to toggle milk curing bad omen

---
 src/main/java/net/minecraft/server/ItemMilkBucket.java | 2 ++
 src/main/java/net/pl3x/purpur/PurpurWorldConfig.java   | 5 +++++
 2 files changed, 7 insertions(+)

diff --git a/src/main/java/net/minecraft/server/ItemMilkBucket.java b/src/main/java/net/minecraft/server/ItemMilkBucket.java
index b7dd5e3c07..93131de75c 100644
--- a/src/main/java/net/minecraft/server/ItemMilkBucket.java
+++ b/src/main/java/net/minecraft/server/ItemMilkBucket.java
@@ -20,7 +20,9 @@ public class ItemMilkBucket extends Item {
         }
 
         if (!world.isClientSide) {
+            MobEffect badOmen = entityliving.getEffect(MobEffects.BAD_OMEN); // Purpur
             entityliving.removeAllEffects(org.bukkit.event.entity.EntityPotionEffectEvent.Cause.MILK); // CraftBukkit
+            if (!world.purpurConfig.milkCuresBadOmen && badOmen != null) entityliving.addEffect(badOmen); // Purpur
         }
 
         return itemstack.isEmpty() ? new ItemStack(Items.BUCKET) : itemstack;
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index f8755060f1..81ece70d38 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -111,6 +111,11 @@ public class PurpurWorldConfig {
         itemsCanBreakTurtleEggs = getBoolean("items-can-break-turtle-eggs", itemsCanBreakTurtleEggs);
     }
 
+    public boolean milkCuresBadOmen = false;
+    private void milkCuresBadOmen() {
+        milkCuresBadOmen = getBoolean("milk-cures-bad-omen", milkCuresBadOmen);
+    }
+
     public boolean enderDragonAlwaysDropsEggBlock = false;
     private void enderDragonSettings() {
         enderDragonAlwaysDropsEggBlock = getBoolean("mobs.ender-dragon.always-drop-egg-block", enderDragonAlwaysDropsEggBlock);
-- 
2.24.0

