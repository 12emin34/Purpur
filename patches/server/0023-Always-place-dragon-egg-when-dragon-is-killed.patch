From cf4910c1723f54cdd5f195294ef83f7950eb16f2 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Sat, 1 Jun 2019 01:16:35 -0500
Subject: [PATCH] Always place dragon egg when dragon is killed

---
 .../minecraft/server/EnderDragonBattle.java   |  4 +++-
 .../java/net/pl3x/purpur/PurpurConfig.java    | 19 +++++++++++++++++++
 2 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EnderDragonBattle.java b/src/main/java/net/minecraft/server/EnderDragonBattle.java
index 6700c8c65..8dab537e9 100644
--- a/src/main/java/net/minecraft/server/EnderDragonBattle.java
+++ b/src/main/java/net/minecraft/server/EnderDragonBattle.java
@@ -13,6 +13,8 @@ import java.util.Set;
 import java.util.UUID;
 import java.util.function.Predicate;
 import javax.annotation.Nullable;
+
+import net.pl3x.purpur.PurpurConfig;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -356,7 +358,7 @@ public class EnderDragonBattle {
             this.bossBattle.setVisible(false);
             this.a(true);
             this.n();
-            if (!this.l) {
+            if (PurpurConfig.enderDragonAlwaysDropsEggBlock || !this.l) { // Purpur - always place dragon egg
                 this.d.setTypeUpdate(this.d.getHighestBlockYAt(HeightMap.Type.MOTION_BLOCKING, WorldGenEndTrophy.a), Blocks.DRAGON_EGG.getBlockData());
             }
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurConfig.java b/src/main/java/net/pl3x/purpur/PurpurConfig.java
index 4c25d358f..16fb9478a 100644
--- a/src/main/java/net/pl3x/purpur/PurpurConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurConfig.java
@@ -142,6 +142,25 @@ public class PurpurConfig {
         feedMushroomsToCows = getInt("settings.mobs.cow.feed-mushrooms-for-mooshroom", feedMushroomsToCows);
     }
 
+    public static boolean enderDragonAlwaysDropsEggBlock = false;
+    private static void enderDragonSettings() {
+        if (version < 2) {
+            boolean oldValue = getBoolean("ender-dragon-death-always-places-egg-block", enderDragonAlwaysDropsEggBlock);
+            oldValue = getBoolean("settings.ender-dragon-death-always-places-egg-block", oldValue);
+
+            set("ender-dragon-death-always-places-egg-block", null);
+            set("settings.ender-dragon-death-always-places-egg-block", null);
+
+            set("settings.mobs.ender-dragon.always-drop-egg-block", oldValue);
+        }
+        enderDragonAlwaysDropsEggBlock = getBoolean("settings.mobs.ender-dragon.always-drop-egg-block", enderDragonAlwaysDropsEggBlock);
+    }
+
+    public static boolean tulipsChangeFoxType = true;
+    private static void foxSettings() {
+        tulipsChangeFoxType = getBoolean("settings.mobs.fox.tulips-change-type", tulipsChangeFoxType);
+    }
+
     public static boolean giantsNaturallySpawn = true;
     public static boolean giantsHaveAI = true;
     private static void giantsSettings() {
-- 
2.23.0.rc1

