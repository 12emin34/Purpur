From 7d4c2f44657a5d43208d8baa1c1ec7285d2cf692 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Thu, 26 Mar 2020 19:46:44 -0500
Subject: [PATCH] Breedable Polar Bears

---
 .../net/minecraft/server/EntityPolarBear.java | 34 ++++++++++++++++++-
 .../net/pl3x/purpur/PurpurWorldConfig.java    |  8 +++++
 2 files changed, 41 insertions(+), 1 deletion(-)

diff --git a/src/main/java/net/minecraft/server/EntityPolarBear.java b/src/main/java/net/minecraft/server/EntityPolarBear.java
index 69e5c1aed..6506e0055 100644
--- a/src/main/java/net/minecraft/server/EntityPolarBear.java
+++ b/src/main/java/net/minecraft/server/EntityPolarBear.java
@@ -28,15 +28,45 @@ public class EntityPolarBear extends EntityAnimal implements IEntityAngerable {
 
     @Override
     public boolean k(ItemStack itemstack) {
-        return false;
+        return world.purpurConfig.polarBearBreedableItem != null && itemstack.getItem() == world.purpurConfig.polarBearBreedableItem; // Purpur;
     }
 
+    // Purpur start
+    @Override
+    public boolean mate(EntityAnimal entityanimal) {
+        if (entityanimal == this) {
+            return false;
+        } else if (this.isStanding()) {
+            return false;
+        } else if (this.getGoalTarget() != null) {
+            return false;
+        } else if (!(entityanimal instanceof EntityPolarBear)) {
+            return false;
+        } else {
+            EntityPolarBear polarbear = (EntityPolarBear) entityanimal;
+            if (polarbear.isStanding()) {
+                return false;
+            }
+            if (polarbear.getGoalTarget() != null) {
+                return false;
+            }
+            return this.isInLove() && polarbear.isInLove();
+        }
+    }
+    // Purpur end
+
     @Override
     protected void initPathfinder() {
         super.initPathfinder();
         this.goalSelector.a(0, new PathfinderGoalFloat(this));
         this.goalSelector.a(1, new EntityPolarBear.c());
         this.goalSelector.a(1, new EntityPolarBear.d());
+        // Purpur start
+        if (world.purpurConfig.polarBearBreedableItem != null) {
+            this.goalSelector.a(2, new PathfinderGoalBreed(this, 1.0D));
+            this.goalSelector.a(3, new PathfinderGoalTempt(this, 1.0D, RecipeItemStack.a(world.purpurConfig.polarBearBreedableItem), false));
+        }
+        // Purpur end
         this.goalSelector.a(4, new PathfinderGoalFollowParent(this, 1.25D));
         this.goalSelector.a(5, new PathfinderGoalRandomStroll(this, 1.0D));
         this.goalSelector.a(6, new PathfinderGoalLookAtPlayer(this, EntityHuman.class, 6.0F));
@@ -178,10 +208,12 @@ public class EntityPolarBear extends EntityAnimal implements IEntityAngerable {
         return flag;
     }
 
+    public boolean isStanding() { return eN(); } // Purpur - OBFHELPER
     public boolean eN() {
         return (Boolean) this.datawatcher.get(EntityPolarBear.bv);
     }
 
+    public void setStanding(boolean standing) { t(standing); } // Purpur - OBFHELPER
     public void t(boolean flag) {
         this.datawatcher.set(EntityPolarBear.bv, flag);
     }
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index 0593d2fe9..012fa3f0a 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -148,6 +148,14 @@ public class PurpurWorldConfig {
         ironGolemCanSwim = getBoolean("mobs.iron_golem.can-swim", ironGolemCanSwim);
     }
 
+    public String polarBearBreedableItemString = "";
+    public Item polarBearBreedableItem = null;
+    private void polarBearSettings() {
+        polarBearBreedableItemString = getString("mobs.polar_bear.breedable-item", polarBearBreedableItemString);
+        Item item = IRegistry.ITEM.get(new MinecraftKey(polarBearBreedableItemString));
+        if (item != Items.AIR) polarBearBreedableItem = item;
+    }
+
     public double rabbitNaturalToast = 0.0D;
     public double rabbitNaturalKiller = 0.0D;
     private void rabbitSettings() {
-- 
2.26.2

