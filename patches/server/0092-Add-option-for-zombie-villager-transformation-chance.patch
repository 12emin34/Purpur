From 7317f20bd412f8e45c0d9f35fcba233256eb9f0f Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Thu, 19 Dec 2019 16:59:46 -0600
Subject: [PATCH] Add option for zombie villager transformation chance

---
 src/main/java/net/minecraft/server/EntityZombie.java | 6 +-----
 src/main/java/net/pl3x/purpur/PurpurWorldConfig.java | 2 ++
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/src/main/java/net/minecraft/server/EntityZombie.java b/src/main/java/net/minecraft/server/EntityZombie.java
index 1e60cc399b..fc4e51ef45 100644
--- a/src/main/java/net/minecraft/server/EntityZombie.java
+++ b/src/main/java/net/minecraft/server/EntityZombie.java
@@ -474,11 +474,7 @@ public class EntityZombie extends EntityMonster {
     @Override
     public void b(EntityLiving entityliving) {
         super.b(entityliving);
-        if ((this.world.getDifficulty() == EnumDifficulty.NORMAL || this.world.getDifficulty() == EnumDifficulty.HARD) && entityliving instanceof EntityVillager) {
-            if (this.world.getDifficulty() != EnumDifficulty.HARD && this.random.nextBoolean()) {
-                return;
-            }
-
+        if (entityliving instanceof EntityVillager && world.purpurConfig.zombieVillagerTransformationChance < 0 ? (world.getDifficulty() == EnumDifficulty.NORMAL ? random.nextBoolean() : world.getDifficulty() == EnumDifficulty.HARD) : world.purpurConfig.zombieVillagerTransformationChance != 0 && !(random.nextDouble() > world.purpurConfig.zombieVillagerTransformationChance)) { // Purpur
             EntityVillager entityvillager = (EntityVillager) entityliving;
             EntityZombieVillager entityzombievillager = (EntityZombieVillager) EntityTypes.ZOMBIE_VILLAGER.a(this.world);
 
diff --git a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
index 4c4f404a30..e79b4df1a7 100644
--- a/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
+++ b/src/main/java/net/pl3x/purpur/PurpurWorldConfig.java
@@ -864,11 +864,13 @@ public class PurpurWorldConfig {
     public boolean zombieRidableInWater = false;
     public boolean zombieRequireShiftToMount = true;
     public boolean zombieTargetTurtleEggs = true;
+    public double zombieVillagerTransformationChance = -0.1D;
     private void zombieSettings() {
         zombieRidable = getBoolean("mobs.zombie.ridable", zombieRidable);
         zombieRidableInWater = getBoolean("mobs.zombie.ridable-in-water", zombieRidableInWater);
         zombieRequireShiftToMount = getBoolean("mobs.zombie.require-shift-to-mount", zombieRequireShiftToMount);
         zombieTargetTurtleEggs = getBoolean("mobs.zombie.target-turtle-eggs", zombieTargetTurtleEggs);
+        zombieVillagerTransformationChance = getDouble("mobs.zombie.transform-to-villager-chance", zombieVillagerTransformationChance);
     }
 
     public boolean zombieHorseCanSwim = false;
-- 
2.24.0

