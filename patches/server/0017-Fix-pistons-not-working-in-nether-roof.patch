From a8f2de4f00321e36cd8faf16c2f392ef7ed6ddd7 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <blake.galbreath@gmail.com>
Date: Sun, 12 May 2019 06:15:25 -0500
Subject: [PATCH] Fix pistons not working in nether roof

---
 src/main/java/net/minecraft/server/BlockPiston.java  | 2 +-
 src/main/java/net/minecraft/server/IBlockAccess.java | 2 +-
 src/main/java/net/minecraft/server/World.java        | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/main/java/net/minecraft/server/BlockPiston.java b/src/main/java/net/minecraft/server/BlockPiston.java
index a5573f21f..61bfa1e78 100644
--- a/src/main/java/net/minecraft/server/BlockPiston.java
+++ b/src/main/java/net/minecraft/server/BlockPiston.java
@@ -248,7 +248,7 @@ public class BlockPiston extends BlockDirectional {
         } else if (!world.getWorldBorder().a(blockposition)) {
             return false;
         } else if (blockposition.getY() >= 0 && (enumdirection != EnumDirection.DOWN || blockposition.getY() != 0)) {
-            if (blockposition.getY() <= world.getHeight() - 1 && (enumdirection != EnumDirection.UP || blockposition.getY() != world.getHeight() - 1)) {
+            if (blockposition.getY() <= world.getDefHeight() - 1 && (enumdirection != EnumDirection.UP || blockposition.getY() != world.getDefHeight() - 1)) { // Purpur - use bgr.I() not bhh.W()
                 if (block != Blocks.PISTON && block != Blocks.STICKY_PISTON) {
                     if (iblockdata.f(world, blockposition) == -1.0F) {
                         return false;
diff --git a/src/main/java/net/minecraft/server/IBlockAccess.java b/src/main/java/net/minecraft/server/IBlockAccess.java
index c44edda65..1f0fd6869 100644
--- a/src/main/java/net/minecraft/server/IBlockAccess.java
+++ b/src/main/java/net/minecraft/server/IBlockAccess.java
@@ -21,7 +21,7 @@ public interface IBlockAccess {
         return 15;
     }
 
-    default int getHeight() {
+    default int getDefHeight() { // Purpur - this is bgr.I()
         return 256;
     }
 
diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index a9a358955..d9cbfbe4a 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -1450,7 +1450,7 @@ public abstract class World implements IIBlockAccess, GeneratorAccess, AutoClose
 
     public void b(int i, BlockPosition blockposition, int j) {}
 
-    @Override
+    //@Override // Purpur -  this is bhh.W() not bgr.I() there is a HUGE difference!
     public int getHeight() {
         return this.worldProvider.h() ? 128 : 256;
     }
-- 
2.20.1

